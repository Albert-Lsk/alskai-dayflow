---
name: alskai-dayflow
description: 工作状态管理器 - 让每一天都留下可复用的认知资产
version: 1.0.3
author: ALSKai
triggers:
  - /turn-me-on
  - /turn-me-off
  - /turn-me-to
  - 开启今天的工作模式
  - 启动工作日
  - 结束今天的工作
  - 归档今天
  - 帮我切换到
---

# WorkState Manager (alskai-dayflow)

**核心价值**: 让每一天都留下可复用的认知资产

**目标用户**: 多任务并行的知识工作者（产品经理、工程师、创作者）

---

## 功能概述

一个Skill，三个命令，统一命名体系 `turn-me-*`：

1. **`/turn-me-on`** - 工作日启动器（早上使用）
2. **`/turn-me-off`** - 工作日归档器（晚上使用）
3. **`/turn-me-to`** - 任务切换助手（工作中使用）

**单一文档原则**: 每天只生成一个文档，不分散成多个文件

**文档生命周期**:
- 早上 `/turn-me-on` 生成初始文档（所有任务为 `- [ ]` 状态）
- 工作中 `/turn-me-to` 使用 str_replace 将切换记录追加写入文档内的"任务切换暂存区"
- 晚上 `/turn-me-off` 在同一文档上更新 checkbox 状态、汇总切换记录、追加归档内容

**文件结构**:
```
DailyReview/
  └── 2026-02-09.md     ← 一天只有这一个文件，所有信息全在里面
  └── 2026-02-10.md
```

---

## 命令1: /turn-me-on - 工作日启动器

### 触发条件
- 用户输入 `/turn-me-on`
- 用户说"开启今天的工作模式"
- 用户说"启动工作日"

### 工作流程

#### 步骤1: 获取当前日期

使用 web_search 工具获取真实的当前日期，**不要依赖AI的内部时间**：

```
搜索关键词: "current date today"
解析搜索结果，提取日期信息
格式化为 YYYY-MM-DD 格式（例如：2026-02-11）
```

同时计算昨天的日期，使用以下逻辑：

```python
from datetime import datetime, timedelta
today = datetime.strptime("{获取到的日期}", "%Y-%m-%d")
yesterday = today - timedelta(days=1)
yesterday_str = yesterday.strftime("%Y-%m-%d")
# 正确处理跨月、跨年边界，例如：
# 2026-03-01 的昨天 → 2026-02-28
# 2026-01-01 的昨天 → 2025-12-31
```

#### 步骤2: 创建文件夹结构

使用 bash 工具检查并创建 DailyReview 文件夹（只需创建一次，后续每天直接在里面生成新文件）：

```bash
mkdir -p "DailyReview"
```

#### 步骤3: 检查是否已存在今天的文档

检查文件是否存在：`DailyReview/{DATE}.md`

**如果文件已存在**:
- 询问用户："今天已经生成过启动文档，是要【覆盖重新生成】还是【查看现有文档】？"
- 如果选择"覆盖"：继续后续流程
- 如果选择"查看"：读取并展示现有文档，结束流程

**如果文件不存在**:
- 继续后续流程

#### 步骤3.5: 读取昨天的文档（如果存在）

检查文件是否存在：`DailyReview/{YESTERDAY_DATE}.md`

**如果昨天的文档存在**:
1. 读取文档内容
2. 提取"🔄 从昨天继承的 Open Loops"部分（如果有）
3. 提取"🌙 晚间归档"下的"📈 今日核心收获"部分（如果有）
4. 解析每一个 Open Loop，提取：
   - 任务名称
   - 首次出现日期
   - 最后更新日期
5. 计算每个 Open Loop 的沉寂天数：`沉寂天数 = 今天日期 - 最后更新日期`
6. 如果沉寂天数 ≥ 7，在该任务名后追加警告标记：`⚠️ 已X天未更新，建议今天推进或暂缓`

**如果昨天的文档不存在**:
- 跳过此步骤，继续后续流程

#### 步骤4: 收集今日计划信息

**核心问题**（必问）：

询问用户："今天最重要的三件事是什么？"（可以少于3个）

**Open Loops 处理**（如果从昨天继承了 Open Loops）：

将 Open Loops 列表展示给用户，并询问：

> "以下是从昨天继承的未完成任务，今天打算推进哪些？有没有要暂缓或删除的？"

- 对于含有 `⚠️` 警告标记的任务，**主动追问**：
  > "【任务名】已经 X 天没有更新了，今天打算怎么处理？继续推进、暂缓还是删掉？"
- 根据用户反馈，调整 Open Loops 列表：
  - 继续推进 → 保留，更新"今日计划"字段
  - 暂缓 → 从列表中移除（用户自行维护归档）
  - 删除 → 从列表中移除

**如果没有继承的 Open Loops**：
- 询问用户："有没有正在进行中的长期任务需要记录进来？"
- 如果有，收集任务信息，按 Open Loop 格式创建条目

**可选信息**（不主动追问，如果用户提到则记录）：
- 会议安排
- 精力状态
- 时间分配预估

#### 步骤5: 生成 WorkDay 文档

使用本文档末尾的**「WorkDay 文档模板」**，替换占位符后生成完整内容：

- `{DATE}` → 当前日期（YYYY-MM-DD）
- `{TIME}` → 当前时间（HH:MM）
- `{GOAL_1}` / `{GOAL_2}` / `{GOAL_3}` → 用户提供的今日三大目标
- `{OPEN_LOOPS_SECTION}` → 整理后的 Open Loops 列表（如果为空则填写"（暂无）"）
- `{YESTERDAY_SUMMARY}` → 昨日核心收获（如果为空则填写"（首次使用）"）

#### 步骤6: 保存文档

将生成的文档保存到：`DailyReview/{DATE}.md`

#### 步骤7: 输出确认

向用户展示：
- ✅ 文档已生成
- 📁 文件位置：`DailyReview/{DATE}.md`
- 💡 工作中使用 `/turn-me-to` 切换任务，晚上使用 `/turn-me-off` 归档

---

## 命令2: /turn-me-off - 工作日归档器

### 触发条件
- 用户输入 `/turn-me-off`
- 用户说"结束今天的工作"
- 用户说"归档今天"

### 工作流程

#### 步骤1: 获取当前日期并检测文档

1. 使用 web_search 获取当前日期（YYYY-MM-DD 格式）
2. 检查今天的文档是否存在：`DailyReview/{DATE}.md`

**分支判断**:
- 如果文档存在 → 进入**正常归档流程**（步骤2）
- 如果文档不存在 → 进入**补记流程**（步骤9）

---

#### 步骤2: 读取今天的文档（正常流程）

读取文档内容：`DailyReview/{DATE}.md`

提取以下信息：
1. 所有待办事项（`- [ ]` 格式的任务）
2. 今日三大目标列表
3. Open Loops 列表（如果有）

---

#### 步骤3: 收集任务完成情况

将所有待办事项一次性列出，询问用户完成情况：

```
"让我们回顾一下今天的任务：

1. [任务1名称]
2. [任务2名称]
3. [任务3名称]

哪些完成了？哪些没完成？"
```

**收集信息**:
- 完成的任务：询问"大概几点完成的？"（如用户不记得可填写"~完成"）
- 未完成的任务：询问"原因是什么？明天打算怎么处理？"

---

#### 步骤4: 更新 Checkbox 状态

使用 str_replace 工具逐一更新每个任务的状态（每次只替换一个任务）：

**完成的任务**:
```
旧文本: - [ ] 任务名称
新文本: - [x] 任务名称 ⏱️ 完成于 HH:MM
```

**未完成的任务**:
```
旧文本: - [ ] 任务名称
新文本: - [ ] ~~任务名称~~ 📅 延期原因：XXX
```

**注意**: 精确匹配原始文本（包括缩进和空格），使用 UTF-8 编码。

---

#### 步骤5: 处理 Open Loops

如果文档中存在 Open Loops，逐一询问用户今天的推进情况：

> "你的 Open Loops 里有以下任务，今天有推进吗？"

对每个 Open Loop：

- **如果今天有推进**（完成、部分完成、有新进展）：
  - 使用 str_replace 更新"最后更新"日期为今天：
    ```
    旧文本: - 最后更新: YYYY-MM-DD
    新文本: - 最后更新: {TODAY_DATE}
    ```
  - 如果完全完成，同时更新 checkbox 为 `- [x]`

- **如果今天没有推进**：
  - 保持"最后更新"日期不变，不做任何修改

---

#### 步骤6: 读取任务切换记录

读取今天的 `DailyReview/{DATE}.md` 文档中的"🔄 任务切换暂存区"模块：

- **如果暂存区有内容**：解析所有切换记录，用于填充晚间归档的"任务切换记录"模块
- **如果暂存区为空或显示"（今天还没有任务切换记录）"**：晚间归档的切换记录模块填写"今天未使用 /turn-me-to"

---

#### 步骤7: 收集晚间归档信息

通过对话收集以下信息：

1. **今日核心收获**：询问"今天最大的收获是什么？学到了什么规律或方法？"（收集1-3条）
2. **新想法/新发现**：询问"今天有什么新想法或灵感吗？"（没有可跳过）
3. **未闭环事项**：询问"有哪些事情需要传递给明天？"
4. **今日状态评分**：询问"给今天的状态打个分？（1-5星）顺带说说感受。"

---

#### 步骤8: 追加晚间归档内容 + 更新状态标记

**第一步**：更新文档顶部状态标记（使用 str_replace）：

```
旧文本: | 状态: 进行中
新文本: | 状态: ✅ 已归档 {TIME}
```

**第二步**：在文档末尾追加晚间归档内容：

```markdown
---

## 🌙 晚间归档

### 📈 今日核心收获
- {收获1}
- {收获2}

### 💡 新想法/新发现
- {想法1}
- {想法2}

### 🔗 未闭环事项（传递给明天）
- {未完成事项1}
- {未完成事项2}

### 🔄 任务切换记录
{从文档内"任务切换暂存区"读取的记录，或"今天未使用 /turn-me-to"}

### 🧘 今日状态评分
{⭐数量} ({X}/5)
评价：{用户的简短评价}

### 💾 存档信息
本文档：`DailyReview/{DATE}.md`
归档时间：{TIME}
```

---

#### 步骤9: 补记流程（无文档时）

**触发条件**: 今天的 WorkDay.md 不存在（首次使用、或早上忘了运行 `/turn-me-on`）

**友好提示**:
> "没关系！我来帮你补记一下今天的工作。虽然早上没有启动文档，但我们可以一起回顾今天做了什么。"

**补记步骤**:

1. 询问："今天早上原本打算完成哪些任务？"
2. 询问："这些任务中，哪些实际完成了？大概几点完成的？"
3. 询问："哪些没完成？原因是什么？"
4. 询问："除了计划的任务，有没有临时增加的任务？"
5. 收集晚间归档信息（收获、想法、评分）
6. 使用本文档末尾的**「WorkDay 文档模板（补记版）」**生成完整文档
7. 保存到：`DailyReview/{DATE}.md`

---

#### 步骤10: 输出确认

向用户展示：
- ✅ 归档完成
- 📁 文件位置：`DailyReview/{DATE}.md`
- 📊 今日统计：完成 X 个任务，未完成 X 个，评分 {⭐}
- 💡 明天早上使用 `/turn-me-on` 启动新的一天

---

## 命令3: /turn-me-to - 任务切换助手

### 触发条件
- 用户输入 `/turn-me-to 从任务A切到任务B`
- 用户输入 `/turn-me-to 新任务名称`
- 用户说"帮我切换到XX任务"

### 工作流程

#### 步骤1: 识别切换意图

解析用户输入，识别当前任务和新任务。

**如果用户只说"切到XX"没说"从XX"**:
- 询问："你当前正在做什么任务？"

---

#### 步骤2: 生成当前任务存档

询问用户以下信息，然后输出结构化存档：

- "当前任务做到哪了？"
- "有什么未完成的思路或想法？"
- "遇到什么卡点了吗？"

输出格式：

```markdown
## 📦 当前任务存档：[任务名称]

### 当前进度
做到哪了：XXX

### 未完成的思路
- XXX

### 遇到的卡点
- XXX

### 下次回来的启动提示
💡 下次继续时，从 XXX 开始
💡 需要准备：XXX
```

---

#### 步骤3: 生成新任务上下文加载

询问用户新任务的背景（如果是已知任务可跳过），输出上下文：

```markdown
## 🎯 新任务上下文：[任务名称]

### 任务背景
XXX

### 需要准备的材料
- XXX

### 关键注意点
- XXX
```

---

#### 步骤4: 将切换记录追加写入 WorkDay.md

**重要**：切换记录直接写入今天的文档，贯彻单一文档原则。

读取今天的文档：`DailyReview/{DATE}.md`

使用 str_replace 工具，将本次切换记录追加到文档内的"🔄 任务切换暂存区"模块：

**第一次切换时**（暂存区内容为初始占位符）：
```
旧文本: （今天还没有任务切换记录）
新文本:
**第1次切换 | {TIME}**
从：[任务A] → 到：[任务B]
原因：[切换原因，未提供则填"未说明"]
```

**后续切换时**（暂存区已有记录，在末尾追加）：
```
旧文本: 原因：[上一条记录的原因]
新文本: 原因：[上一条记录的原因]

**第N次切换 | {TIME}**
从：[任务A] → 到：[任务B]
原因：[切换原因，未提供则填"未说明"]
```

**注意**:
- 切换记录直接写入 WorkDay.md，不创建任何外部文件
- 晚上运行 `/turn-me-off` 时直接从文档的"任务切换暂存区"读取记录

---

#### 步骤5: 特殊功能 - 回到上一个任务

如果用户说"回到上一个任务"或"切回去"：
- 读取 `DailyReview/{DATE}.md` 文档内"任务切换暂存区"的最后一条记录
- 展示对应任务的"下次回来的启动提示"
- 帮助用户快速恢复工作状态

---

#### 步骤6: 输出确认

向用户展示：
- ✅ 切换完成，当前任务已存档
- 🎯 新任务上下文已加载
- 📝 切换记录已写入 `DailyReview/{DATE}.md`
- 💡 晚上使用 `/turn-me-off` 时会自动汇总今天所有切换记录

---

## 文档格式规范

### Checkbox 格式（严格遵守，中间必须有空格）

```markdown
- [ ] 待完成任务
- [x] 已完成任务 ⏱️ 完成于 14:30
- [ ] ~~未完成任务~~ 📅 延期原因：XXX
```

### Open Loop 格式

```markdown
- [ ] **任务名称**
  - 首次出现: YYYY-MM-DD
  - 最后更新: YYYY-MM-DD
  - 延期原因: XXX
  - 今日计划: XXX
```

沉寂 ≥ 7 天时，在任务名后追加警告标记：

```markdown
- [ ] **任务名称** ⚠️ 已12天未更新，建议今天推进或暂缓
  - 首次出现: YYYY-MM-DD
  - 最后更新: YYYY-MM-DD
  - 延期原因: XXX
  - 今日计划: XXX
```

---

## 实现说明

### 工具使用

| 工具 | 用途 |
|------|------|
| web_search | 获取真实的当前日期 |
| bash | 创建文件夹结构 |
| view | 读取历史文档和今日文档 |
| create_file | 创建新的 WorkDay.md |
| str_replace | 更新 checkbox 状态、Open Loop 时间戳、追加切换记录、顶部状态标记 |

### 文件路径

| 文件 | 路径 |
|------|------|
| 主文档（唯一文件） | `DailyReview/{DATE}.md` |

### 注意事项

1. **日期获取**: 必须使用 web_search 获取真实日期，不要使用 AI 内部时间
2. **昨天日期计算**: 使用 datetime + timedelta 计算，正确处理跨月、跨年边界
3. **路径处理**: 使用相对路径，在用户的工作目录下创建文件
4. **编码**: 所有文件使用 UTF-8 编码
5. **单一文档原则**: 一天所有信息（包括切换记录）都写入同一个 WorkDay.md，不创建任何额外文件

---

## WorkDay 文档模板

> 以下模板在 `/turn-me-on` 步骤5 中直接使用，无需读取外部文件。

```markdown
# 🌅 {DATE} 工作日志

> 生成时间: {TIME} | 状态: 进行中

---

## 🎯 今日三大目标

- [ ] {GOAL_1}
- [ ] {GOAL_2}
- [ ] {GOAL_3}

---

## 🔄 从昨天继承的 Open Loops

{OPEN_LOOPS_SECTION}

---

## ✅ 昨日收获快照

{YESTERDAY_SUMMARY}

---

## 💭 想法池 / 待孵化项目

（工作中随时补充）

---

## 🔄 任务切换暂存区

<!-- 由 /turn-me-to 自动追加，请勿手动编辑 -->
（今天还没有任务切换记录）

---

<!-- 🌙 晚间归档区：由 /turn-me-off 自动填充，请勿手动编辑以下内容 -->
```

---

## WorkDay 文档模板（补记版）

> 以下模板在 `/turn-me-off` 补记流程（步骤9）中使用。

```markdown
# 🌅 {DATE} 工作日志

> ⚠️ 补记生成 | 生成时间: {TIME} | 状态: ✅ 已归档 {TIME}

> 📝 本文档为晚间补记生成，早上计划部分基于回忆整理。建议明天养成早上运行 `/turn-me-on` 的习惯。

---

## 🎯 今日计划（补记）

{补记的计划任务和完成情况，含 checkbox 状态}

### 临时增加的任务

{补记的临时任务，含 checkbox 状态}

---

## 🔄 从昨天继承的 Open Loops

（补记模式下为空，可手动补充）

---

## ✅ 昨日收获快照

（补记模式下为空）

---

## 💭 想法池 / 待孵化项目

（补记模式下为空，可手动补充）

---

## 🌙 晚间归档

### 📈 今日核心收获
{收获列表}

### 💡 新想法/新发现
{想法列表}

### 🔗 未闭环事项（传递给明天）
{未完成事项列表}

### 🔄 任务切换记录
（补记模式下无切换记录）

### 🧘 今日状态评分
{⭐数量} ({X}/5)
评价：{用户评价}

### 💾 存档信息
本文档：`DailyReview/{DATE}.md`
归档时间：{TIME}
提醒：明天记得运行 `/turn-me-on` 开启新的一天！
```

---
**版本**: 1.0.3 (MVP - 阶段1，扁平文件结构 DailyReview/{DATE}.md)
**最后更新**: 2026-02-18
